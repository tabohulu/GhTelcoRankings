<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <title>Document</title>
    <style>
      .card {
        width: 100%;
        margin: 2px;
        flex-shrink: 0;

        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;

        scroll-snap-align: start;
        scroll-snap-stop: always;
      }

      .container {
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: center;
        width: 100%;
        padding: 5px;
      }

      .card-div {
        font-size: larger;
        background-color: #e5f0f1;
        width: 100vh;
        height: 40vh;
        border: 1px solid blueviolet;
        border-radius: 5px;
        display: flex;
        align-items: center;
        flex-wrap: nowrap;
        overflow-x: scroll;

        overscroll-behavior: contain;

        /* hide scroll bar */
        scrollbar-width: none;
        -ms-overflow-style: none;

        /* momentum scroll on iOS */
        -webkit-overflow-scrolling: touch;

        /* disbable vertical scroll for touch */
        /*touch-action: pan-x;*/

        /* scroll snapping */
        scroll-snap-type: x mandatory;
      }

      .card-div::-webkit-scrollbar {
        display: none;
      }

      #submit {
        background-color: #0095ff;
        border: 1px solid transparent;
        border-radius: 3px;
        box-shadow: rgba(255, 255, 255, 0.4) 0 1px 0 0 inset;
        box-sizing: border-box;
        color: #fff;
        cursor: pointer;
        display: inline-block;
        font-family: -apple-system, system-ui, "Segoe UI", "Liberation Sans",
          sans-serif;
        font-size: 13px;
        font-weight: 400;
        line-height: 1.15385;
        margin: 0;
        outline: none;
        padding: 8px 0.8em;
        text-align: center;
        text-decoration: none;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
        vertical-align: baseline;
        white-space: nowrap;
      }
    </style>
  </head>
  <body>
    <div id="tweets_index" class="container">1/{{tweets|length}}</div>
    <div class="container">
      <span
        id="left"
        class="nav material-icons"
        style="font-size: 3em; color: rgb(180, 170, 170)"
        >arrow_back_ios</span
      >

      <form action="/work_submitted" method="post" id="form">
        <div class="card-div">
          {%for i in range(tweets|length)%}
          <div class="card">
            <p class="tweet_body">{{tweets[i].body}}</p>
            <div class="container">
              <p>
                <input
                  type="radio"
                  name="{{tweets[i].id}}-sentiment"
                  id="{{tweets[i].id}}-negative"
                  value="-1"
                />
                <label for="{{tweets[i].id}}-negative">negative</label>
              </p>
              <p>
                <input
                  type="radio"
                  name="{{tweets[i].id}}-sentiment"
                  id="{{tweets[i].id}}-neutral"
                  value="0"
                />
                <label for="{{tweets[i].id}}-neutral">neutral</label>
              </p>
              <p>
                <input
                  type="radio"
                  name="{{tweets[i].id}}-sentiment"
                  id="{{tweets[i].id}}-positive"
                  value="1"
                />
                <label for="{{tweets[i].id}}-positive">positive</label>
              </p>
            </div>
          </div>

          {%endfor%}
        </div>
      </form>

      <span
        id="right"
        class="nav material-icons"
        style="font-size: 3em; color: rgb(180, 170, 170)"
      >
        arrow_forward_ios
      </span>
    </div>

    <div class="container">
      <div id="submit">Submit</div>
    </div>

    <script>
      series_quotes_bb = [];
      let questions_card_container =
        document.getElementsByClassName("card-div")[0];
      let questions_card_container_bb =
        questions_card_container.getBoundingClientRect();
      let sa = Array.from(document.getElementsByClassName("card"));
      let questions_nav = Array.from(document.getElementsByClassName("nav"));
      let question_index = 0;
      let question_number_para = document.getElementById("tweets_index");
      let no_of_quotes = Number(question_number_para.innerText.split("/")[1]);
      questions_nav.forEach((card) => {
        card.onclick = myscrollToDiv;
      });

      sa.forEach((s) => {
        series_quotes_bb.push(s.getBoundingClientRect());
      });

      let radios = Array.from(document.querySelectorAll("input[type=radio]"));
      radios.forEach((radio) => {
        radio.onclick = getSelected;
      });

      let submit_button = document.getElementById("submit");
      let form = document.getElementById("form");
      submit_button.disabled = true;
      submit_button.style.display = "none";
      submit_button.onclick = () => {
        console.log("here");
        form.submit();
      };
      questions_answered = 0;

      function myscrollToDiv(event) {
        if (event.target.id === "left") {
          question_index =
            question_index - 1 >= 0 ? question_index - 1 : question_index;
        } else {
          question_index =
            question_index + 1 < no_of_quotes
              ? question_index + 1
              : question_index;
        }
        questions_card_container.scrollTo(
          series_quotes_bb[question_index].x - series_quotes_bb[0].x,
          questions_card_container_bb.y
        );
        question_number_para.innerText = `${
          question_index + 1
        }/${no_of_quotes}`;
      }

      function getSelected(event) {
        questions_answered += 1;
        console.log(`questions answered: ${questions_answered}`);

        // let index = Number(event.target.id[0]);

        // selected_answers[index] = {
        //   answer: event.target.value,
        //   isCorrect: event.target.value === series_quotes[index].author,
        // };

        //move to next question
        question_index =
          question_index + 1 < no_of_quotes
            ? question_index + 1
            : question_index;

        scrollAction();
        // is_question_answered[index] = 1;

        //make button active if all questions answered
        if (questions_answered >= no_of_quotes) {
          submit_button.disabled = false;
          submit_button.style.display = "flex";
        }
      }

      function scrollAction() {
        questions_card_container.scrollTo(
          series_quotes_bb[question_index].x - series_quotes_bb[0].x,
          questions_card_container_bb.y
        );
        question_number_para.innerText = `${
          question_index + 1
        }/${no_of_quotes}`;
      }
    </script>
  </body>
</html>
